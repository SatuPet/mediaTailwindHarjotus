<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/dist/output.css" rel="stylesheet" />
    <link href="/dist/chat.css" rel="stylesheet" />
  </head>
    <title>Socket.IO chat</title>
  </head>

  <body class="bg-[url('light6.jpeg')] backdrop-blur-sm bg-white/30  2xl:max-w-1/2 max-w-1/3 m-auto">
    <header class="flex justify-around m-16">
      <a href="/src/index.html">
      <button class="btn-test w-32">Koti</button>
    </a>
    <a href="/src/tapahtumat.html">
      <button class="btn-test w-32">Tapahtumat</button>
    </a>
    <a href="./chat/chat.html">
      <button class="btn-test w-32">Haku</button>
  </a>
    </header>
    <!-- <audio controls src="http://51.11.247.177:8000/stream"></audio> -->
    <section class="flex lg:flex-row flex-col justify-around">
      <div class="box-border p-4 h-30 w-100 bg-test mr-2 mb-1">
        <p class="text-center">Hei!<br>tule keskustelemaan chatissa kokemuksista!</p></div>
<section class="kokeilu ml-2 mt-1">

    <ul id="messages">
    <section class="rooms">
        <button roomName="room 1" class="roombtn">Room 1</button>
        <button roomName="room 2" class="roombtn">Room 2</button>
        <button roomName="room 3" class="roombtn">Room 3</button>
    </section>
    </ul>

    <form id="form" action="">
      <input id="input" autocomplete="off" /><button>Send</button>
    </form>
  </section>
</section>



    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();
      const username = prompt("Please enter your name");
      var messages = document.getElementById('messages');
      var form = document.getElementById('form');
      var input = document.getElementById('input');
      var roomButtons = document.querySelectorAll('.roombtn');
      var selectedRoom = 'room 1'

      // join default room 
      socket.emit('join room',selectedRoom);

      roomButtons.forEach(button => {
          button.addEventListener('click', (e) => {
              socket.emit('leave room',selectedRoom);
              selectedRoom = e.target.getAttribute('roomName');
              socket.emit('join room',selectedRoom);
          });
      });

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (input.value) {
           let messageJson = {
               'message': input.value,
               'sender': username,
               'room': selectedRoom
           }
          socket.emit('chat message', JSON.stringify(messageJson));
          input.value = '';
        }
      });
    
      socket.on('chat message', function(msg) {
        parsedMsg = JSON.parse(msg);
        var item = document.createElement('li');
        item.textContent = `${parsedMsg.sender}: ${parsedMsg.message}`
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });
    </script>
  </body>
</html>
